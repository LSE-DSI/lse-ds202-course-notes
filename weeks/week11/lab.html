<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Jon Cardoso-Silva">
<meta name="dcterms.date" content="5 December 2022">

<title>LSE DS202 2022/23 - üíª Week 11 - Lab Roadmap (90 min)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//figures/logos/LSE Data Science Institute.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../css/custom_style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">LSE DS202 2022/23</span>
    </a>
  </div>
          <div class="quarto-toggle-container ms-auto">
              <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">üíª Week 11 - Lab Roadmap (90 min)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">üè† Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/syllabus.html" class="sidebar-item-text sidebar-link">üìì Syllabus</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/communication.html" class="sidebar-item-text sidebar-link">üìü Communication</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/assessments.html" class="sidebar-item-text sidebar-link">‚úçÔ∏è Assessments</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/courserep.html" class="sidebar-item-text sidebar-link">üó≥Ô∏è Course Rep</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/main.html" class="sidebar-item-text sidebar-link">üìö Blog</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">üóìÔ∏è Weeks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week01.html" class="sidebar-item-text sidebar-link">Week 01</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/prep.html" class="sidebar-item-text sidebar-link">üìí Prepare for next week‚Äôs lab</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/appendix.html" class="sidebar-item-text sidebar-link">üîñ Appendix</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week02.html" class="sidebar-item-text sidebar-link">Week 02</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week03.html" class="sidebar-item-text sidebar-link">Week 03</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week04.html" class="sidebar-item-text sidebar-link">Week 04</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week05.html" class="sidebar-item-text sidebar-link">Week 05</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week06.html" class="sidebar-item-text sidebar-link">Week 06</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week06/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week06/drop_in_jon.html" class="sidebar-item-text sidebar-link">üíª Drop-in Session 01</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week07.html" class="sidebar-item-text sidebar-link">Week 07</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week08.html" class="sidebar-item-text sidebar-link">Week 08</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lab_advanced.html" class="sidebar-item-text sidebar-link">‚ú® Bonus Lab (Optional)</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week09.html" class="sidebar-item-text sidebar-link">Week 09</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/appendix.html" class="sidebar-item-text sidebar-link">üîñ Appendix</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week10.html" class="sidebar-item-text sidebar-link">Week 10</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week10/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week10/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week10/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week10/bonus.html" class="sidebar-item-text sidebar-link">‚ú® Bonus Lab (Optional)</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="../../figures/logos/LSE Data Science Institute.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup-10-min" id="toc-setup-10-min" class="nav-link active" data-scroll-target="#setup-10-min">Setup (10 min)</a>
  <ul class="collapse">
  <li><a href="#new-packages-you-will-need-to-install" id="toc-new-packages-you-will-need-to-install" class="nav-link" data-scroll-target="#new-packages-you-will-need-to-install">New packages you will need to install</a></li>
  <li><a href="#packages-you-will-need" id="toc-packages-you-will-need" class="nav-link" data-scroll-target="#packages-you-will-need">Packages you will need</a></li>
  </ul></li>
  <li><a href="#step-1-the-data-10-min" id="toc-step-1-the-data-10-min" class="nav-link" data-scroll-target="#step-1-the-data-10-min">Step 1: The Data (10 min)</a>
  <ul class="collapse">
  <li><a href="#the-raw-data" id="toc-the-raw-data" class="nav-link" data-scroll-target="#the-raw-data">The raw data</a></li>
  <li><a href="#create-a-df_pac" id="toc-create-a-df_pac" class="nav-link" data-scroll-target="#create-a-df_pac">Create a <code>df_pac</code></a></li>
  <li><a href="#create-an-apology-id-column" id="toc-create-an-apology-id-column" class="nav-link" data-scroll-target="#create-an-apology-id-column">Create an <code>Apology ID</code> column</a></li>
  </ul></li>
  <li><a href="#step-2-summarising-text-data-25-min" id="toc-step-2-summarising-text-data-25-min" class="nav-link" data-scroll-target="#step-2-summarising-text-data-25-min">Step 2: Summarising text data (25 min)</a>
  <ul class="collapse">
  <li><a href="#step-2.1-of-corpuses-and-tokens" id="toc-step-2.1-of-corpuses-and-tokens" class="nav-link" data-scroll-target="#step-2.1-of-corpuses-and-tokens">Step 2.1: Of corpuses and tokens</a>
  <ul class="collapse">
  <li><a href="#tokens" id="toc-tokens" class="nav-link" data-scroll-target="#tokens">Tokens</a></li>
  </ul></li>
  <li><a href="#step-2.2-document-frequency-matrix-dfm" id="toc-step-2.2-document-frequency-matrix-dfm" class="nav-link" data-scroll-target="#step-2.2-document-frequency-matrix-dfm">Step 2.2: Document-Frequency Matrix (<code>dfm</code>)</a>
  <ul class="collapse">
  <li><a href="#top-features" id="toc-top-features" class="nav-link" data-scroll-target="#top-features">Top features</a></li>
  </ul></li>
  <li><a href="#step-2.3-keywords-in-context-kwic" id="toc-step-2.3-keywords-in-context-kwic" class="nav-link" data-scroll-target="#step-2.3-keywords-in-context-kwic">Step 2.3: Keywords In Context (<code>kwic</code>)</a></li>
  </ul></li>
  <li><a href="#step-3-pre-processing-30-min" id="toc-step-3-pre-processing-30-min" class="nav-link" data-scroll-target="#step-3-pre-processing-30-min">Step 3: Pre-processing (30 min)</a>
  <ul class="collapse">
  <li><a href="#step-3.1.-extract-the-object-of-the-apology" id="toc-step-3.1.-extract-the-object-of-the-apology" class="nav-link" data-scroll-target="#step-3.1.-extract-the-object-of-the-apology">Step 3.1. Extract the object of the apology</a>
  <ul class="collapse">
  <li><a href="#a-different-pattern" id="toc-a-different-pattern" class="nav-link" data-scroll-target="#a-different-pattern">A different pattern</a></li>
  <li><a href="#handling-duplicates" id="toc-handling-duplicates" class="nav-link" data-scroll-target="#handling-duplicates">Handling duplicates</a></li>
  </ul></li>
  <li><a href="#step-3.2.-rebuild-the-corpus-tokens-and-dfm" id="toc-step-3.2.-rebuild-the-corpus-tokens-and-dfm" class="nav-link" data-scroll-target="#step-3.2.-rebuild-the-corpus-tokens-and-dfm">Step 3.2. Rebuild the corpus, tokens and dfm</a>
  <ul class="collapse">
  <li><a href="#get-rid-of-unnecessary-tokens" id="toc-get-rid-of-unnecessary-tokens" class="nav-link" data-scroll-target="#get-rid-of-unnecessary-tokens">Get rid of unnecessary tokens</a></li>
  <li><a href="#document-term-matrix" id="toc-document-term-matrix" class="nav-link" data-scroll-target="#document-term-matrix">Document-Term Matrix</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#step-4.-dimensionality-reduction-clustering" id="toc-step-4.-dimensionality-reduction-clustering" class="nav-link" data-scroll-target="#step-4.-dimensionality-reduction-clustering">Step 4. Dimensionality Reduction + Clustering</a>
  <ul class="collapse">
  <li><a href="#step-4.1-pca-k-means" id="toc-step-4.1-pca-k-means" class="nav-link" data-scroll-target="#step-4.1-pca-k-means">Step 4.1 PCA + k-means</a>
  <ul class="collapse">
  <li><a href="#visualise-it" id="toc-visualise-it" class="nav-link" data-scroll-target="#visualise-it">Visualise it</a></li>
  <li><a href="#a-method-to-determine-the-number-of-clusters" id="toc-a-method-to-determine-the-number-of-clusters" class="nav-link" data-scroll-target="#a-method-to-determine-the-number-of-clusters">A method to determine the number of clusters</a></li>
  <li><a href="#can-k-means-identify-the-3-clusters" id="toc-can-k-means-identify-the-3-clusters" class="nav-link" data-scroll-target="#can-k-means-identify-the-3-clusters">Can K-means identify the 3 clusters?</a></li>
  </ul></li>
  <li><a href="#step-4.2.-latent-sentiment-analysis-k-means" id="toc-step-4.2.-latent-sentiment-analysis-k-means" class="nav-link" data-scroll-target="#step-4.2.-latent-sentiment-analysis-k-means">Step 4.2. Latent Sentiment Analysis + k-means</a>
  <ul class="collapse">
  <li><a href="#can-k-means-identify-the-3-clusters-1" id="toc-can-k-means-identify-the-3-clusters-1" class="nav-link" data-scroll-target="#can-k-means-identify-the-3-clusters-1">Can K-means identify the 3 clusters?</a></li>
  </ul></li>
  <li><a href="#step-4.3-describe-the-clusters" id="toc-step-4.3-describe-the-clusters" class="nav-link" data-scroll-target="#step-4.3-describe-the-clusters">Step 4.3 Describe the clusters</a>
  <ul class="collapse">
  <li><a href="#which-words-best-describe-the-clusters" id="toc-which-words-best-describe-the-clusters" class="nav-link" data-scroll-target="#which-words-best-describe-the-clusters">Which words best describe the clusters?</a></li>
  </ul></li>
  <li><a href="#step-4.4.-alternative-strategies" id="toc-step-4.4.-alternative-strategies" class="nav-link" data-scroll-target="#step-4.4.-alternative-strategies">Step 4.4. Alternative strategies</a>
  <ul class="collapse">
  <li><a href="#topic-modeling-instead-of-k-means" id="toc-topic-modeling-instead-of-k-means" class="nav-link" data-scroll-target="#topic-modeling-instead-of-k-means">Topic modeling instead of k-means</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">üíª Week 11 - Lab Roadmap (90 min)</h1>
<p class="subtitle lead">DS202 - Data Science for Social Scientists</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Jon Cardoso-Silva </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">05 December 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>In our final lab of DS202, you will learn how to use <a href="https://quanteda.io/">quanteda</a>, an R package for quantitative text analysis. We will do a bit more of data pre-processing, and you will have the chance to apply dimensionality reduction (e.g.&nbsp;PCA) and clustering (e.g.&nbsp;k-means) techniques to text data.</p>
<section id="setup-10-min" class="level1">
<h1>Setup (10 min)</h1>
<section id="new-packages-you-will-need-to-install" class="level2">
<h2 class="anchored" data-anchor-id="new-packages-you-will-need-to-install">New packages you will need to install</h2>
<p>In the R Console ‚Äì never in the RMarkdown ‚Äì run the following commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"plotly"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"NbClust"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"countrycode"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda.textplots"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda.textmodels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packages-you-will-need" class="level2">
<h2 class="anchored" data-anchor-id="packages-you-will-need">Packages you will need</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode) <span class="co"># it contains data that will be useful to our preprocessing</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># to use things like the pipe (%&gt;%)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)  <span class="co"># for model tuning, cross-validation etc.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)      <span class="co"># for interactive charts</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)     <span class="co"># to assess an "optimal" number of clusters</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Vanity packages:</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)       <span class="co"># we like pretty colours</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-1-the-data-10-min" class="level1">
<h1>Step 1: The Data (10 min)</h1>
<p>This dataset we are going to use today, <strong>P</strong>olitical <strong>A</strong>pologies across <strong>C</strong>ultures (<strong>PAC</strong>), was assembled by the <a href="https://twitter.com/PolApol_TiU">Political Apologies x Cultures project</a>. We downloaded it from their website, <a href="https://www.politicalapologies.com/" class="uri">https://www.politicalapologies.com/</a>.</p>
<p>The data consists of an inventory of political apologies offered by states or state representatives to a collective for human rights violations that happened in the recent or distant past.</p>
<section id="the-raw-data" class="level2">
<h2 class="anchored" data-anchor-id="the-raw-data">The raw data</h2>
<p>üéØ <strong>ACTION POINT:</strong> Before we even open it in R, take some time to look at the data in its raw format. Open the file <code>PAC_Apologies_Public-Version-2-modified.xlsx</code> using MS Office.</p>
<p>What do you see? Which tabs and columns seem interesting?</p>
<blockquote class="blockquote">
<p>your notes here</p>
</blockquote>
</section>
<section id="create-a-df_pac" class="level2">
<h2 class="anchored" data-anchor-id="create-a-df_pac">Create a <code>df_pac</code></h2>
<p>We can use the <code>read_excel</code> function from the tidyverse package <code>readxl</code> to read Excel spreadsheets:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_pac <span class="ot">&lt;-</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"PAC_Apologies_Public-Version-2.xlsx"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sheet=</span><span class="dv">1</span>, <span class="at">.name_repair=</span><span class="st">"minimal"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">Date of apology</span><span class="st">`</span><span class="ot">=</span>lubridate<span class="sc">::</span><span class="fu">as_date</span>(<span class="st">`</span><span class="at">Date of apology</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Date of apology</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üí° <em>You might have noticed that I am using the explicit name of the functions (<code>dplyr::mutate</code> instead of <code>mutate</code>, etc.). In the Summative 02, many of you experienced problems running our code because you had other R packages with functions of the same name. So, to avoid any surprises, we will use the full name of functions in several places here. (It‚Äôs also good as it helps to recognise where the functions come from).</em></p>
</section>
<section id="create-an-apology-id-column" class="level2">
<h2 class="anchored" data-anchor-id="create-an-apology-id-column">Create an <code>Apology ID</code> column</h2>
<p>It might be good to have a column with a very short identifier of the apology. We are looking for a short version to identify who apologies to who and when, something like:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1947-03-04</span> USA <span class="ot">-&gt;</span> MEX</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ü§î How would you do that when we do not have abbreviated country names? And how would you treat the cases of missing values in the <code>Country (Receiver)</code> column?</p>
<p>‚ö†Ô∏è For now, just believe me: it is possible, the code below deals precisely with that. BUT it is a bit much to digest this early in a lab, so for now let‚Äôs just run it and observe the output in the <code>Apology ID</code> column.</p>
<p>Later, as a üè† <strong>TAKE-HOME ACTIVITY:</strong>, try to understand every single step of the huge pipe below. Ask questions on Slack if you do not get any detail!</p>
<p><em>By the way, if you want to practice this kind of advanced pre-processing, you should consider taking our sister course, DS105!</em></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preamble: function countrycode::countrycode() receives a country name and</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           returns its abbreviated version. However, some countries' names in</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           our data are not recognised by the function, so we need to treat these cases. </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df_pac <span class="ot">&lt;-</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  df_pac <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename a few cases to match countrycode::countrycode() mapping</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Country "</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(. <span class="sc">==</span> <span class="st">"GDR"</span> <span class="sc">~</span> <span class="st">"German Democratic Republic"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                                   . <span class="sc">==</span> <span class="st">"Antigua and Barbuda"</span> <span class="sc">~</span> <span class="st">"Antigua &amp; Barbuda"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                                   . <span class="sc">==</span> <span class="st">"Phillipines"</span> <span class="sc">~</span> <span class="st">"Philipines"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> .))) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We don't need these columns</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Database "</span>),<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Source "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the iso3c abbreviation standard does not work, use the p4c</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If nothing else works, keep </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Country"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(countrycode<span class="sc">::</span><span class="fu">countrycode</span>(., </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">origin=</span><span class="st">"country.name"</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">destination=</span><span class="st">"iso3c"</span>, </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">warn=</span><span class="cn">FALSE</span>)),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">if_else</span>(<span class="fu">is.na</span>(countrycode<span class="sc">::</span><span class="fu">countrycode</span>(., </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="at">origin=</span><span class="st">"country.name"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="at">destination=</span><span class="st">"p4c"</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="at">warn=</span><span class="cn">FALSE</span>)),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                                  .,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                                  countrycode<span class="sc">::</span><span class="fu">countrycode</span>(., </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">origin=</span><span class="st">"country.name"</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">destination=</span><span class="st">"p4c"</span>, </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">warn=</span><span class="cn">FALSE</span>)),</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                          countrycode<span class="sc">::</span><span class="fu">countrycode</span>(., </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">origin=</span><span class="st">"country.name"</span>, </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">destination=</span><span class="st">"iso3c"</span>, </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">warn=</span><span class="cn">FALSE</span>)),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names=</span><span class="st">"{.col} (abbr.)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the above did not encounter any valid abbreviation (it is na),</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    we can still extract the receiver of the apology from the `Parties involved` column</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    For this, I need to use function str_split but because this function is </span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    not vectorized, I had to get creative...</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Country (Receiver) (abbr.)</span><span class="st">`</span><span class="ot">=</span><span class="fu">coalesce</span>(<span class="st">`</span><span class="at">Country (Receiver) (abbr.)</span><span class="st">`</span>, </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">sapply</span>(<span class="st">`</span><span class="at">Parties involved</span><span class="st">`</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                                                      <span class="cf">function</span>(x){</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                                                        stringr<span class="sc">::</span><span class="fu">str_split</span>(x, <span class="st">" to "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                                                          purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">substr</span>(<span class="dv">1</span>,<span class="dv">13</span>)} ))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is just to put these abbreviations together.</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the data had already come clean, this would be the only step we would need!</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Apology ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(df_pac<span class="sc">$</span><span class="st">`</span><span class="at">Date of apology</span><span class="st">`</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">Country (sender) (abbr.)</span><span class="st">`</span>, <span class="st">"-&gt;"</span>, <span class="st">`</span><span class="at">Country (Receiver) (abbr.)</span><span class="st">`</span>, <span class="at">sep=</span><span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now look at that beautiful <code>Apology ID</code> column. Satisfying? Yes. Worth it? ‚Ä¶</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_pac <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">`</span><span class="at">Apology ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-2-summarising-text-data-25-min" class="level1">
<h1>Step 2: Summarising text data (25 min)</h1>
<section id="step-2.1-of-corpuses-and-tokens" class="level2">
<h2 class="anchored" data-anchor-id="step-2.1-of-corpuses-and-tokens">Step 2.1: Of corpuses and tokens</h2>
<p>The first step when performing quantitative text analysis is to create a <code>corpus</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>corp_pac <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">corpus</span>(df_pac, <span class="at">text_field=</span><span class="st">"Description according to database"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>quanteda<span class="sc">::</span><span class="fu">docnames</span>(corp_pac) <span class="ot">&lt;-</span> df_pac<span class="sc">$</span><span class="st">`</span><span class="at">Apology ID</span><span class="st">`</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>corp_pac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Once you have constructed this corpus, use the summary() method to see a brief description of the corpus.</em></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_corpus <span class="ot">&lt;-</span> <span class="fu">summary</span>(corp_pac)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_corpus, <span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> (</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_corpus, <span class="fu">aes</span>(<span class="at">x=</span>Tokens))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">geom_bar</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Number of Tokens"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Count"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">title=</span><span class="st">"How many tokens are there in the Description of Apology?"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="tokens" class="level3">
<h3 class="anchored" data-anchor-id="tokens">Tokens</h3>
<p>In order to count word frequencies, we first need to split the text into words (or longer phrases) through a process known as <em>tokenization</em>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function extracts the tokens</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tokens_pac <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens</span>(corp_pac)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>tokens_pac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tokens_pac[[<span class="dv">1</span>]] <span class="co"># to look at just the first one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-2.2-document-frequency-matrix-dfm" class="level2">
<h2 class="anchored" data-anchor-id="step-2.2-document-frequency-matrix-dfm">Step 2.2: Document-Frequency Matrix (<code>dfm</code>)</h2>
<p>Now, let‚Äôs <strong>summarise</strong> the tokens in our corpus. We use the document-frequency matrix to create, as the name implies, a matrix that contains the number of times a token appears in a document.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dfm_pac <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">dfm</span>(tokens_pac) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dfm_pac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can convert <code>dfm_pac</code> to a dataframe if we like:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dfm_as_data_frame <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(dfm_pac, <span class="at">to=</span><span class="st">"data.frame"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dfm_as_data_frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üéØ <strong>ACTION POINT</strong> Look at the dataframe that represents the document-frequency matrix with either <code>View(dfm_as_data_frame)</code> or <code>head(dfm_as_data_frame)</code></p>
<p>üó£Ô∏è <strong>CLASSROOM DISCUSSIONS</strong>: What do you think all of these columns represent?</p>
<section id="top-features" class="level3">
<h3 class="anchored" data-anchor-id="top-features">Top features</h3>
<p>What are the most frequent tokens?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dfm_pac <span class="sc">%&gt;%</span> quanteda<span class="sc">::</span><span class="fu">topfeatures</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>It is fun to look at wordclouds:</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>quanteda.textplots<span class="sc">::</span><span class="fu">textplot_wordcloud</span>(dfm_pac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üó£Ô∏è <strong>CLASSROOM DISCUSSIONS</strong>: Do you think these most frequent terms are useful in helping us understand the political apologies? Would you remove certain tokens?</p>
<p><em>Have you heard of the term ‚Äòstop words‚Äô before? Ask your class teacher about this! Quanteda has a built-in list of commonly used stop words, view it by running the function <code>quanteda::stopwords("en")</code>.</em></p>
</section>
</section>
<section id="step-2.3-keywords-in-context-kwic" class="level2">
<h2 class="anchored" data-anchor-id="step-2.3-keywords-in-context-kwic">Step 2.3: Keywords In Context (<code>kwic</code>)</h2>
<p>Before we revisit our tokens, let‚Äôs take a look at an interesting feature of <code>quanteda</code>. We can search for a pattern (a keyword) in our corpus and see the text that surrounds it using the <code>kwic</code> function.</p>
<p>üéØ <strong>ACTION POINT:</strong> Use <code>kwic</code> to search for keywords associated with different forms of explicit description of apologies:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>quanteda<span class="sc">::</span><span class="fu">kwic</span>(tokens_pac <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>), <span class="at">pattern=</span><span class="st">"apolog*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üó£Ô∏è <strong>CLASSROOM DISCUSSIONS</strong>: What do you think the <code>*</code> in the <code>pattern="apolog*"</code> parameter does?</p>
<p>The above is an example of a regular expression (<strong>regex</strong>), a language just for expressing patterns of strings. You can read more about regex in <a href="https://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions">Chapter 14 of R for Data Science book</a></p>
</section>
</section>
<section id="step-3-pre-processing-30-min" class="level1">
<h1>Step 3: Pre-processing (30 min)</h1>
<p>Let‚Äôs try to make this data more interesting for further analysis. Here we will:</p>
<ul>
<li>use the power of <code>kwic</code> to try to extract just the <strong>object of the apology</strong></li>
<li>build a new corpus out of this new subset of text data</li>
<li>remove unnecessary tokens (stop words + punctuation)</li>
</ul>
<section id="step-3.1.-extract-the-object-of-the-apology" class="level2">
<h2 class="anchored" data-anchor-id="step-3.1.-extract-the-object-of-the-apology">Step 3.1. Extract the object of the apology</h2>
<p>The output of <code>kwic</code> can be converted to a dataframe. Let‚Äôs look at that same sample again, only this time we increased the <code>window</code> of tokens that show up before and after the keyword:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>quanteda<span class="sc">::</span><span class="fu">kwic</span>(tokens_pac <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>), <span class="at">pattern=</span><span class="st">"apolog*"</span>, <span class="at">window=</span><span class="dv">40</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The info we care about the most is the column <code>post</code>.</p>
<section id="a-different-pattern" class="level3">
<h3 class="anchored" data-anchor-id="a-different-pattern">A different pattern</h3>
<p>This is good but there is a downside to the keyword we used. Not all entries have the term <code>apolog*</code> in their description. We will have to use a more complex pattern:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  quanteda<span class="sc">::</span><span class="fu">kwic</span>(tokens_pac,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pattern=</span><span class="st">"apolog*|regre*|sorrow*|recogni*|around*|sorry*|remorse*|failur*"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">window=</span><span class="dv">40</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We seemed to have lost some documents. The original document has 367 rows.</p>
<p>üéØ <strong>ACTION POINT:</strong> Take a look at <code>View(df_new)</code></p>
</section>
<section id="handling-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="handling-duplicates">Handling duplicates</h3>
<p>Some rows are repeated because of multiple pattern matches in the same text:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(docname) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here is how we are going to deal with these duplicates: let‚Äôs keep just the one with the longest <code>post</code> text. This is equivalent to selecting the one with earliest <code>from</code> value in the dataframe above.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="ot">&lt;-</span> df_new <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(from) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(docname) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note:</strong> This is a choice, there is no absolute objective way to handle this case. Would you do anything differently?</p>
<p>üè† <strong>TAKE-HOME (OPTIONAL) ACTIVITY:</strong> We used to have 367 rows, now we have 327. How would you change the <code>pattern</code> so as to avoid excluding data from the original dataframe? (Note: I do not have a ready solution to this! Feel free to share yours.)</p>
</section>
</section>
<section id="step-3.2.-rebuild-the-corpus-tokens-and-dfm" class="level2">
<h2 class="anchored" data-anchor-id="step-3.2.-rebuild-the-corpus-tokens-and-dfm">Step 3.2. Rebuild the corpus, tokens and dfm</h2>
<p>A new corpus</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>corp_pac <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">corpus</span>(df_new, <span class="at">text_field=</span><span class="st">"post"</span>, <span class="at">docid_field=</span><span class="st">"docname"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>corp_pac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="get-rid-of-unnecessary-tokens" class="level3">
<h3 class="anchored" data-anchor-id="get-rid-of-unnecessary-tokens">Get rid of unnecessary tokens</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tokens_pac <span class="ot">&lt;-</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of punctuations</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  quanteda<span class="sc">::</span><span class="fu">tokens</span>(corp_pac, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of stopwords</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  quanteda<span class="sc">::</span><span class="fu">tokens_remove</span>(<span class="at">pattern =</span> quanteda<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>tokens_pac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="document-term-matrix" class="level3">
<h3 class="anchored" data-anchor-id="document-term-matrix">Document-Term Matrix</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dfm_pac <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">dfm</span>(tokens_pac)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>quanteda.textplots<span class="sc">::</span><span class="fu">textplot_wordcloud</span>(dfm_pac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_word_frequency <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">convert</span>(dfm_pac, <span class="at">to=</span><span class="st">"data.frame"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_word_frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üó£Ô∏è <strong>CLASSROOM DISCUSSIONS</strong>: What do you think of the wordcloud above, compared to the previous one? How would it be different if we had removed unnecessary tokens but kept the original longer description?</p>
</section>
</section>
</section>
<section id="step-4.-dimensionality-reduction-clustering" class="level1">
<h1>Step 4. Dimensionality Reduction + Clustering</h1>
<p>Instead of running k-means or any other clustering algorithm on the full dfm, let‚Äôs reduce the number of features of our dataset. This would save storage and make the process run faster.</p>
<section id="step-4.1-pca-k-means" class="level2">
<h2 class="anchored" data-anchor-id="step-4.1-pca-k-means">Step 4.1 PCA + k-means</h2>
<p>Can PCA be of any help for this dataset?</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Code adapted from W10 lab</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(<span class="sc">~</span> ., <span class="at">data =</span> df_word_frequency) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(doc_id, <span class="at">new_role=</span><span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>pca_prep <span class="ot">&lt;-</span> <span class="fu">prep</span>(pca_recipe)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add PC1 &amp; PC2 to `df_lsa`</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> <span class="fu">bake</span>(pca_prep, df_word_frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_prep<span class="sc">$</span>steps[[<span class="dv">2</span>]]<span class="sc">$</span>res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="visualise-it" class="level3">
<h3 class="anchored" data-anchor-id="visualise-it">Visualise it</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_pca, df_new), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>PC1, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>PC2, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, doc_id, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>üó£Ô∏è <strong>CLASSROOM DISCUSSIONS:</strong> What would you say? How many clusters are in there?</p>
</section>
<section id="a-method-to-determine-the-number-of-clusters" class="level3">
<h3 class="anchored" data-anchor-id="a-method-to-determine-the-number-of-clusters">A method to determine the number of clusters</h3>
<p>Here is a more robust alternative to an elbow plot for deciding the number of clusters:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>res.nbclust <span class="ot">&lt;-</span> df_pca <span class="sc">%&gt;%</span> <span class="fu">select</span>(PC1, PC2) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NbClust</span>(<span class="at">distance =</span> <span class="st">"manhattan"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min.nc =</span> <span class="dv">2</span>, <span class="at">max.nc =</span> <span class="dv">10</span>, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">index =</span><span class="st">"all"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The indices have voted! The majority believe k=3.</p>
</section>
<section id="can-k-means-identify-the-3-clusters" class="level3">
<h3 class="anchored" data-anchor-id="can-k-means-identify-the-3-clusters">Can K-means identify the 3 clusters?</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df_pca <span class="sc">%&gt;%</span> <span class="fu">select</span>(PC1, PC2), <span class="at">centers=</span><span class="dv">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(model, df_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_pca, df_new), </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>PC1, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>PC2, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span>.cluster,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, doc_id, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Those clusters are very awkward‚Ä¶</p>
<p>But at least it highlights two outliers:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(df_pca, df_new) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.cluster <span class="sc">!=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-4.2.-latent-sentiment-analysis-k-means" class="level2">
<h2 class="anchored" data-anchor-id="step-4.2.-latent-sentiment-analysis-k-means">Step 4.2. Latent Sentiment Analysis + k-means</h2>
<p>Let‚Äôs try an alternative dimensionality reduction technique called Latent Sentiment Analysis (LSA), and let‚Äôs keep just 2 dimensions:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_lsa <span class="ot">&lt;-</span> quanteda.textmodels<span class="sc">::</span><span class="fu">textmodel_lsa</span>(dfm_pac, <span class="at">nd=</span><span class="dv">2</span>)<span class="sc">$</span>docs <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_lsa, df_new), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>V1, </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>V2, </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, docname, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This seems to make more sense, right?</p>
<p><strong>How many clusters are there?</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>res.nbclust <span class="ot">&lt;-</span> df_lsa <span class="sc">%&gt;%</span> <span class="fu">select</span>(V1, V2) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NbClust</span>(<span class="at">distance =</span> <span class="st">"manhattan"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min.nc =</span> <span class="dv">2</span>, <span class="at">max.nc =</span> <span class="dv">10</span>, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">index =</span><span class="st">"all"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="can-k-means-identify-the-3-clusters-1" class="level3">
<h3 class="anchored" data-anchor-id="can-k-means-identify-the-3-clusters-1">Can K-means identify the 3 clusters?</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df_lsa <span class="sc">%&gt;%</span> <span class="fu">select</span>(V1, V2), <span class="at">centers=</span><span class="dv">3</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df_lsa <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(model, df_lsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_lsa, df_new), </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>V1, </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>V2, </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span>.cluster,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, docname, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bad K-means! Let‚Äôs try k=7, the second best voted number of clusters:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df_lsa <span class="sc">%&gt;%</span> <span class="fu">select</span>(V1, V2), <span class="at">centers=</span><span class="dv">7</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_lsa <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">augment</span>(model, df_lsa)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_lsa, df_new), </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>V1, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>V2, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span>.cluster,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, docname, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-4.3-describe-the-clusters" class="level2">
<h2 class="anchored" data-anchor-id="step-4.3-describe-the-clusters">Step 4.3 Describe the clusters</h2>
<section id="which-words-best-describe-the-clusters" class="level3">
<h3 class="anchored" data-anchor-id="which-words-best-describe-the-clusters">Which words best describe the clusters?</h3>
<p>We can use the concept of <code>keyness</code> to score words in relation to a target vs a reference group. Read more about keyness <a href="https://tutorials.quanteda.io/statistical-analysis/keyness/">here</a>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>tstat_key <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_pac, <span class="at">target =</span> df_lsa<span class="sc">$</span>.cluster <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_key, <span class="at">labelsize=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Plot a wordcloud with just the <strong>target</strong> group:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>quanteda.textplots<span class="sc">::</span><span class="fu">textplot_wordcloud</span>(tstat_key, <span class="at">comparison=</span><span class="cn">FALSE</span>, <span class="at">min_count=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Wordcloud to compare target vs reference:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>quanteda.textplots<span class="sc">::</span><span class="fu">textplot_wordcloud</span>(tstat_key, <span class="at">comparison=</span><span class="cn">TRUE</span>, <span class="at">min_count=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-4.4.-alternative-strategies" class="level2">
<h2 class="anchored" data-anchor-id="step-4.4.-alternative-strategies">Step 4.4. Alternative strategies</h2>
<section id="topic-modeling-instead-of-k-means" class="level3">
<h3 class="anchored" data-anchor-id="topic-modeling-instead-of-k-means">Topic modeling instead of k-means</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(topicmodels)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>tmod_lda <span class="ot">&lt;-</span> topicmodels<span class="sc">::</span><span class="fu">LDA</span>(dfm_pac, <span class="at">k =</span> <span class="dv">7</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="do">## What is in each topic?</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>tmod_lda <span class="sc">%&gt;%</span> topicmodels<span class="sc">::</span><span class="fu">terms</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Assign each row to a topic:</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_lsa[<span class="st">"topic"</span>] <span class="ot">&lt;-</span> tmod_lda <span class="sc">%&gt;%</span> topicmodels<span class="sc">::</span><span class="fu">topics</span>() <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_lsa <span class="sc">%&gt;%</span> <span class="fu">count</span>(topic) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because topicmodeling runs directly on <code>dfm</code>, it does not recognise nor does it match PCA or LSA coordinates:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span>  <span class="fu">bind_cols</span>(df_lsa, df_new), </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>V1, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>V2, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span>topic,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">"scatter"</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode=</span><span class="st">"markers"</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Doc ID:'</span>, docname, <span class="st">'</span><span class="sc">\n</span><span class="st">Description:</span><span class="sc">\n</span><span class="st">'</span>, post))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tstat_key <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_pac, <span class="at">target =</span> df_lsa<span class="sc">$</span>topic <span class="sc">==</span> <span class="dv">3</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_key, <span class="at">labelsize=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Think about it:</strong></p>
<ul>
<li><p>We have experimented with a lot of different things. Which topic/clustering/spatial representation makes more sense to you?</p></li>
<li><p>Why not try exploring the data with different clustering algorithms? Take a look at <a href="https://www.datanovia.com/en/blog/types-of-clustering-methods-overview-and-quick-start-r-code/">this link</a> for code samples of <strong>hierarchical clustering</strong> and <a href="https://www.datanovia.com/en/lessons/dbscan-density-based-clustering-essentials/">this one</a> for <strong>DBSCAN</strong>.</p></li>
<li><p>You can also try finding alternative R packages that implements other clustering algorithms shown in <a href="https://scikit-learn.org/stable/modules/clustering.html">Python‚Äôs sklearn package</a>.</p></li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/(?:lse-dsi\.github\.io\/|localhost)/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, LSE Data Science Institute</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:DSI.Admin@lse.ac.uk">
      <i class="bi bi-mailbox" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/lsedatascience">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>