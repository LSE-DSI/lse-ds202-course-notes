<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Jon Cardoso-Silva">
<meta name="dcterms.date" content="2022-11-14">

<title>LSE DS202 2022/23 - ‚ú® Bonus Lab (Optional) - Cross-validation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../weeks/week09.html" rel="next">
<link href="../../weeks/week08/lab.html" rel="prev">
<link href="../..//figures/logos/LSE Data Science Institute.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../css/custom_style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">LSE DS202 2022/23</span>
    </a>
  </div>
          <div class="quarto-toggle-container ms-auto">
              <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">‚ú® Bonus Lab (Optional) - Cross-validation</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">üè† Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/syllabus.html" class="sidebar-item-text sidebar-link">üìì Syllabus</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/communication.html" class="sidebar-item-text sidebar-link">üìü Communication</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/assessments.html" class="sidebar-item-text sidebar-link">‚úçÔ∏è Assessments</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../main/courserep.html" class="sidebar-item-text sidebar-link">üó≥Ô∏è Course Rep</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/main.html" class="sidebar-item-text sidebar-link">üìö Blog</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">üóìÔ∏è Weeks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week01.html" class="sidebar-item-text sidebar-link">Week 01</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/prep.html" class="sidebar-item-text sidebar-link">üìí Prepare for next week‚Äôs lab</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week01/appendix.html" class="sidebar-item-text sidebar-link">üîñ Appendix</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week02.html" class="sidebar-item-text sidebar-link">Week 02</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week02/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week03.html" class="sidebar-item-text sidebar-link">Week 03</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture Slides</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week03/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week04.html" class="sidebar-item-text sidebar-link">Week 04</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week04/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week05.html" class="sidebar-item-text sidebar-link">Week 05</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week05/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week06.html" class="sidebar-item-text sidebar-link">Week 06</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week06/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week06/drop_in_jon.html" class="sidebar-item-text sidebar-link">üíª Drop-in Session 01</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week07.html" class="sidebar-item-text sidebar-link">Week 07</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week07/lab_solutions.html" class="sidebar-item-text sidebar-link">‚úîÔ∏è Lab solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week08.html" class="sidebar-item-text sidebar-link">Week 08</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week08/lab_advanced.html" class="sidebar-item-text sidebar-link active">‚ú® Bonus Lab (Optional)</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../weeks/week09.html" class="sidebar-item-text sidebar-link">Week 09</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/lecture.html" class="sidebar-item-text sidebar-link">üë®‚Äçüè´ Lecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/checklist.html" class="sidebar-item-text sidebar-link">‚úÖ Checklist</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week09/lab.html" class="sidebar-item-text sidebar-link">üíª Lab roadmap</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="../../figures/logos/LSE Data Science Institute.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#context" id="toc-context" class="nav-link active" data-scroll-target="#context">Context</a>
  <ul class="collapse">
  <li><a href="#topics" id="toc-topics" class="nav-link" data-scroll-target="#topics">Topics</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#packages-you-will-need" id="toc-packages-you-will-need" class="nav-link" data-scroll-target="#packages-you-will-need">Packages you will need</a></li>
  </ul></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a>
  <ul class="collapse">
  <li><a href="#orange-juice" id="toc-orange-juice" class="nav-link" data-scroll-target="#orange-juice"><span class="emoji" data-emoji="tangerine">üçä</span>Orange Juice</a>
  <ul class="collapse">
  <li><a href="#which-variables-can-help-us-distinguish-the-two-different-brands" id="toc-which-variables-can-help-us-distinguish-the-two-different-brands" class="nav-link" data-scroll-target="#which-variables-can-help-us-distinguish-the-two-different-brands">Which variables can help us distinguish the two different brands?</a></li>
  </ul></li>
  <li><a href="#stock-market" id="toc-stock-market" class="nav-link" data-scroll-target="#stock-market"><span class="emoji" data-emoji="chart_with_upwards_trend">üìà</span> Stock Market</a></li>
  </ul></li>
  <li><a href="#step-4-k-fold-cross-validation-with-tidymodels" id="toc-step-4-k-fold-cross-validation-with-tidymodels" class="nav-link" data-scroll-target="#step-4-k-fold-cross-validation-with-tidymodels">Step 4: k-fold cross validation with <code>tidymodels</code></a>
  <ul class="collapse">
  <li><a href="#step-4.1-create-training-test-split" id="toc-step-4.1-create-training-test-split" class="nav-link" data-scroll-target="#step-4.1-create-training-test-split">Step 4.1: Create training / test split</a></li>
  <li><a href="#step-4.2-create-resampling-folds-for-cross-validation" id="toc-step-4.2-create-resampling-folds-for-cross-validation" class="nav-link" data-scroll-target="#step-4.2-create-resampling-folds-for-cross-validation">Step 4.2: Create resampling folds for cross validation</a></li>
  <li><a href="#step-4.3-specifying-a-recipe" id="toc-step-4.3-specifying-a-recipe" class="nav-link" data-scroll-target="#step-4.3-specifying-a-recipe">Step 4.3: <strong><span class="emoji" data-emoji="fried_egg">üç≥</span></strong>Specifying a recipe</a></li>
  <li><a href="#step-4.4-specify-a-model" id="toc-step-4.4-specify-a-model" class="nav-link" data-scroll-target="#step-4.4-specify-a-model">Step 4.4: Specify a model</a></li>
  <li><a href="#step-4.5-create-a-hyperparameter-grid" id="toc-step-4.5-create-a-hyperparameter-grid" class="nav-link" data-scroll-target="#step-4.5-create-a-hyperparameter-grid">Step 4.5: Create a hyperparameter grid</a></li>
  <li><a href="#step-4.6-perform-cross-validation" id="toc-step-4.6-perform-cross-validation" class="nav-link" data-scroll-target="#step-4.6-perform-cross-validation">Step 4.6: Perform cross-validation</a></li>
  <li><a href="#step-4.7-which-combination-of-hyperparameters-works-best" id="toc-step-4.7-which-combination-of-hyperparameters-works-best" class="nav-link" data-scroll-target="#step-4.7-which-combination-of-hyperparameters-works-best">Step 4.7: Which combination of hyperparameters works best?</a></li>
  </ul></li>
  <li><a href="#take-home-exercises-advanced" id="toc-take-home-exercises-advanced" class="nav-link" data-scroll-target="#take-home-exercises-advanced"><span class="emoji" data-emoji="house">üè†</span> <strong>Take-home exercises</strong> (Advanced)</a>
  <ul class="collapse">
  <li><a href="#q5-re-run-step3-regression" id="toc-q5-re-run-step3-regression" class="nav-link" data-scroll-target="#q5-re-run-step3-regression">Q5: Re-run Step3 (Regression)</a></li>
  <li><a href="#q6-predict-the-external-validation-set" id="toc-q6-predict-the-external-validation-set" class="nav-link" data-scroll-target="#q6-predict-the-external-validation-set">Q6: Predict the external validation set</a></li>
  <li><a href="#q7-svm-decision-space-regression" id="toc-q7-svm-decision-space-regression" class="nav-link" data-scroll-target="#q7-svm-decision-space-regression">Q7: SVM Decision Space (Regression)</a></li>
  <li><a href="#q8-compare-svm-decision-space-plots" id="toc-q8-compare-svm-decision-space-plots" class="nav-link" data-scroll-target="#q8-compare-svm-decision-space-plots">Q8: Compare SVM Decision Space plots</a></li>
  <li><a href="#q9-grid-search-for-orange-juice-classification" id="toc-q9-grid-search-for-orange-juice-classification" class="nav-link" data-scroll-target="#q9-grid-search-for-orange-juice-classification">Q9: Grid search for Orange Juice (Classification)</a></li>
  <li><a href="#q10-challenge" id="toc-q10-challenge" class="nav-link" data-scroll-target="#q10-challenge">Q10: Challenge</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">‚ú® Bonus Lab (Optional) - Cross-validation</h1>
<p class="subtitle lead">DS202 - Data Science for Social Scientists</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jon Cardoso-Silva </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">14 November 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="context" class="level1">
<h1>Context</h1>
<p>Originally, we intended it to be part of <a href="../../weeks/week08/lab.html">W08 lab</a> but decided against it as it would make the lab too cluttered.</p>
<p>Although optional, we think the exercises in here might be a great way to solidify your knowledge of SVM and its parameters.</p>
<section id="topics" class="level2">
<h2 class="anchored" data-anchor-id="topics">Topics</h2>
<p>Here we show an alternative way to perform <a href="../../weeks/week04/lecture.html#the-cross-validation-setup">k-fold cross-validation</a> using <code>tidymodels</code> instead of the <code>cv.glm</code> we saw in W05 lab.</p>
</section>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<p><span class="emoji" data-emoji="bulb">üí°</span> <em>Some of you have mentioned that your R version cannot handle tidymodels. We recommend you update R to version 4.2.0 or above.</em></p>
<section id="packages-you-will-need" class="level2">
<h2 class="anchored" data-anchor-id="packages-you-will-need">Packages you will need</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'ISLR2'</span>)       <span class="co"># for the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'tidyverse'</span>)   <span class="co"># to use things like the pipe (%&gt;%)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'e1071'</span>)       <span class="co"># for SVM model</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'tidymodels'</span>)  <span class="co"># for model tuning, cross-validation etc.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Vanity packages:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'GGally'</span>)      <span class="co"># for pretty correlation plot</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'ggsci'</span>)       <span class="co"># for pretty plot colours</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'cvms'</span>)        <span class="co"># for pretty confusion matrix plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="the-data" class="level1">
<h1>The Data</h1>
<section id="orange-juice" class="level2">
<h2 class="anchored" data-anchor-id="orange-juice"><span class="emoji" data-emoji="tangerine">üçä</span>Orange Juice</h2>
<p>This week we will use a different ISLR2 dataset: <code>OJ</code> . We will perform a <strong>classification</strong> task with the goal to predict the <code>Purchase</code> column.</p>
<blockquote class="blockquote">
<p><em>The data contains 1070 <strong>purchases</strong> where the customer either purchased Citrus Hill or Minute Maid Orange Juice. A number of characteristics of the customer and product are recorded.</em></p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ISLR2<span class="sc">::</span>OJ <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Purchase WeekofPurchase StoreID PriceCH PriceMM DiscCH DiscMM SpecialCH
1       CH            237       1    1.75    1.99   0.00    0.0         0
2       CH            239       1    1.75    1.99   0.00    0.3         0
3       CH            245       1    1.86    2.09   0.17    0.0         0
4       MM            227       1    1.69    1.69   0.00    0.0         0
5       CH            228       7    1.69    1.69   0.00    0.0         0
6       CH            230       7    1.69    1.99   0.00    0.0         0
  SpecialMM  LoyalCH SalePriceMM SalePriceCH PriceDiff Store7 PctDiscMM
1         0 0.500000        1.99        1.75      0.24     No  0.000000
2         1 0.600000        1.69        1.75     -0.06     No  0.150754
3         0 0.680000        2.09        1.69      0.40     No  0.000000
4         0 0.400000        1.69        1.69      0.00     No  0.000000
5         0 0.956535        1.69        1.69      0.00    Yes  0.000000
6         1 0.965228        1.99        1.69      0.30    Yes  0.000000
  PctDiscCH ListPriceDiff STORE
1  0.000000          0.24     1
2  0.000000          0.24     1
3  0.091398          0.23     1
4  0.000000          0.00     1
5  0.000000          0.00     0
6  0.000000          0.30     0</code></pre>
</div>
</div>
<p>To understand what each variable represent, open the R Console, type the following and hit ENTER:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>?ISLR2<span class="sc">::</span>OJ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="which-variables-can-help-us-distinguish-the-two-different-brands" class="level3">
<h3 class="anchored" data-anchor-id="which-variables-can-help-us-distinguish-the-two-different-brands">Which variables can help us distinguish the two different brands?</h3>
<p>To simplify our plots later on, let‚Äôs focus on just two predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>OJ <span class="sc">%&gt;%</span> <span class="fu">select</span>(Purchase, LoyalCH, PriceDiff)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> (</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(plot_df, <span class="fu">aes</span>(<span class="at">colour=</span>Purchase))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customizing the plot</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">scale_colour_startrek</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">scale_fill_startrek</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>g </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab_advanced_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
</section>
</section>
<section id="stock-market" class="level2">
<h2 class="anchored" data-anchor-id="stock-market"><span class="emoji" data-emoji="chart_with_upwards_trend">üìà</span> Stock Market</h2>
<p>We will also use the <code>Smarket</code> dataset from the ISLR2 package. We will perform a <strong>regression</strong> task with the goal to predict the percentage of return of the S&amp;P 500 stock index on any given day, as represented by the <code>Today</code> column.</p>
<blockquote class="blockquote">
<p><em>Daily percentage returns for the S&amp;P 500 stock index between 2001 and 2005.</em></p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ISLR2<span class="sc">::</span>Smarket <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Lag1   Lag2   Lag3   Lag4   Lag5 Volume  Today Direction
1 2001  0.381 -0.192 -2.624 -1.055  5.010 1.1913  0.959        Up
2 2001  0.959  0.381 -0.192 -2.624 -1.055 1.2965  1.032        Up
3 2001  1.032  0.959  0.381 -0.192 -2.624 1.4112 -0.623      Down
4 2001 -0.623  1.032  0.959  0.381 -0.192 1.2760  0.614        Up
5 2001  0.614 -0.623  1.032  0.959  0.381 1.2057  0.213        Up
6 2001  0.213  0.614 -0.623  1.032  0.959 1.3491  1.392        Up</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Smarket <span class="sc">%&gt;%</span> <span class="fu">select</span>(Today, Volume, Lag1, Lag2)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> (</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(plot_df)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customizing the plot</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">scale_colour_startrek</span>()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">scale_fill_startrek</span>()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>g </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab_advanced_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>To understand what each variable represent, open the R Console, type the following and hit ENTER:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>?ISLR2<span class="sc">::</span>Smarket</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-4-k-fold-cross-validation-with-tidymodels" class="level1">
<h1>Step 4: k-fold cross validation with <code>tidymodels</code></h1>
<p>Here we will replicate the cross-validation setup used to generate the structure <a href="../../weeks/week04/lecture.html"><span class="emoji" data-emoji="spiral_calendar">üóìÔ∏è</span> Week 04 lecture/workshop</a>.</p>
<p><strong><span class="emoji" data-emoji="previous_track_button">‚èÆÔ∏è</span>Recap:</strong></p>
<ul>
<li><p>We also explored training vs test splits, albeit in a different way, in <a href="../../weeks/week04/lab.html#step-2.1-separate-some-data-just-for-training">Step 2.1</a> of <a href="../../weeks/week04/lab.html"><span class="emoji" data-emoji="computer">üíª</span> Week 04 - Lab</a></p></li>
<li><p>k-fold cross-validation was also present in <a href="../../weeks/week05/lab.html#step-2-k-fold-cross-validation">Step 2</a> of <a href="../../weeks/week05/lab.html"><span class="emoji" data-emoji="computer">üíª</span> Week 05 - Lab</a></p></li>
<li><p>Cross-validation was also mentioned in the <a href="../../weeks/week05/lecture.html"><span class="emoji" data-emoji="spiral_calendar">üóìÔ∏è</span> Week 05 lecture</a>, when you were introduced the problem of <strong>overfitting</strong>.</p></li>
</ul>
<p><em>But how exactly can cross-validation help overcome overfitting?</em> This is what we will explore in this section of the lab.</p>
<section id="step-4.1-create-training-test-split" class="level2">
<h2 class="anchored" data-anchor-id="step-4.1-create-training-test-split">Step 4.1: Create training / test split</h2>
<p>We start by creating a training / test split using the functions <code>initial_split</code> packages for <span class="emoji" data-emoji="chart_with_upwards_trend">üìà</span> <code>SMarket</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Direction, otherwise we would be "cheating" </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>Smarket <span class="sc">%&gt;%</span> <span class="fu">select</span>(Today, Volume, Lag1)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>default_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(filtered_data, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> Today)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>internal_validation_set <span class="ot">&lt;-</span> <span class="fu">training</span>(default_split)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>external_validation_set <span class="ot">&lt;-</span> <span class="fu">testing</span>(default_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many samples are in the <code>internal validation set</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(internal_validation_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 936</code></pre>
</div>
</div>
<p>How many samples were left in the <code>external validation set</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(external_validation_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 314</code></pre>
</div>
</div>
<p>The external validation set will only be used at the end</p>
</section>
<section id="step-4.2-create-resampling-folds-for-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="step-4.2-create-resampling-folds-for-cross-validation">Step 4.2: Create resampling folds for cross validation</h2>
<p>Next, let‚Äôs create <strong>10-fold</strong> cross-validation data using <code>internal_validation_set</code>. We can achieve this by using the <code>vfold_cv</code> command, specifying <code>v = 10</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>k_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(internal_validation_set, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>k_folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation 
# A tibble: 10 √ó 2
   splits           id    
   &lt;list&gt;           &lt;chr&gt; 
 1 &lt;split [842/94]&gt; Fold01
 2 &lt;split [842/94]&gt; Fold02
 3 &lt;split [842/94]&gt; Fold03
 4 &lt;split [842/94]&gt; Fold04
 5 &lt;split [842/94]&gt; Fold05
 6 &lt;split [842/94]&gt; Fold06
 7 &lt;split [843/93]&gt; Fold07
 8 &lt;split [843/93]&gt; Fold08
 9 &lt;split [843/93]&gt; Fold09
10 &lt;split [843/93]&gt; Fold10</code></pre>
</div>
</div>
<p><em>Notice anything odd? The output is a tibble but the first column <code>splits</code> is a series of lists. This is another thing that makes tibbles different to data frames - you can nest lists within tibbles but not data frames. We will use this more explicitly in the next lab when we build k-means clustering models.</em></p>
</section>
<section id="step-4.3-specifying-a-recipe" class="level2">
<h2 class="anchored" data-anchor-id="step-4.3-specifying-a-recipe">Step 4.3: <strong><span class="emoji" data-emoji="fried_egg">üç≥</span></strong>Specifying a recipe</h2>
<p>The next step is to create a recipe. Luckily, <code>recipe</code> function takes the same values as the <code>lm</code> model! We first create a formula <code>default ~ .</code> and then use <code>data = internal_validation_set</code>. Printing <code>smarket_recipe</code>, we have one outcome and three predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>smarket_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Today <span class="sc">~</span> ., <span class="at">data =</span> internal_validation_set)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>smarket_recipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          2</code></pre>
</div>
</div>
</section>
<section id="step-4.4-specify-a-model" class="level2">
<h2 class="anchored" data-anchor-id="step-4.4-specify-a-model">Step 4.4: Specify a model</h2>
<p>Next, we will specify a support vector machine model. Here‚Äôs where things get a bit more involved.</p>
<p>We specify a radial basis function SVM. <code>svm_rbf</code> takes two <strong>hyperparameters</strong>: <code>cost</code> and <code>rbf_sigma</code>. Instead of specifying a single value for each, we will instead set them equal to <code>tune()</code>. This indicates that we want to try a range of different values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>svm_regressor <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svm_rbf</span>(<span class="at">cost =</span> <span class="fu">tune</span>(), <span class="at">rbf_sigma =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'regression'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4.5-create-a-hyperparameter-grid" class="level2">
<h2 class="anchored" data-anchor-id="step-4.5-create-a-hyperparameter-grid">Step 4.5: Create a hyperparameter grid</h2>
<p>Which values for <code>cost</code> and <code>rbf_sigma</code> should we choose? It is often hard to tell, so instead we can experiment with different values.</p>
<p>We can use <code>grid_regular</code> to create a tibble of different hyperparameter combinations. <code>levels = 5</code> indicates that we want to try out five different values for each hyperparameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>svm_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost</span>(), <span class="fu">rbf_sigma</span>(), <span class="at">levels =</span> <span class="dv">5</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>svm_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 √ó 2
        cost    rbf_sigma
       &lt;dbl&gt;        &lt;dbl&gt;
 1  0.000977 0.0000000001
 2  0.0131   0.0000000001
 3  0.177    0.0000000001
 4  2.38     0.0000000001
 5 32        0.0000000001
 6  0.000977 0.0000000316
 7  0.0131   0.0000000316
 8  0.177    0.0000000316
 9  2.38     0.0000000316
10 32        0.0000000316
# ‚Ä¶ with 15 more rows</code></pre>
</div>
</div>
</section>
<section id="step-4.6-perform-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="step-4.6-perform-cross-validation">Step 4.6: Perform cross-validation</h2>
<p>We now have all we need to run cross-validation, and the function <code>tune_grid</code> puts everything together. Let‚Äôs think intuitively what this command is doing.</p>
<ul>
<li><p>We are telling <code>tune_grid</code> that we want to run a classification model on a recipe using different <strong>resampling</strong> folds.</p></li>
<li><p>Instead of specifying <strong>hyperparameter</strong> values we want to run a combination of different values.</p></li>
<li><p>After this, we want to choose a metric to evaluate different combinations.</p></li>
<li><p>We opt for <code>rmse</code> but we can specify several metrics however using the <code>metric_set</code> command.</p></li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>smarket_tuned <span class="ot">&lt;-</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">object =</span> svm_regressor,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">preprocessor =</span> smarket_recipe,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">resamples =</span> k_folds,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> svm_grid,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4.7-which-combination-of-hyperparameters-works-best" class="level2">
<h2 class="anchored" data-anchor-id="step-4.7-which-combination-of-hyperparameters-works-best">Step 4.7: Which combination of hyperparameters works best?</h2>
<p>Now we have tuned our models, let‚Äôs find out which combination of <strong>hyperparameters</strong> work best. We can create a ggplot easily using the <code>autoplot</code> command.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>smarket_tuned <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_color_jco</span>() <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'RMSE'</span>, <span class="at">colour =</span> <span class="st">'Sigma'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="emoji" data-emoji="dart">üéØ</span> <strong>ACTION POINT</strong>: Can you explain what we see in the plot above?</p>
<blockquote class="blockquote">
<p>your text go here</p>
</blockquote>
<p>We can use the function <code>select_best</code> to identify the hyperparameter combination that leads to the highest precision.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select_best</span>(smarket_tuned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="take-home-exercises-advanced" class="level1">
<h1><span class="emoji" data-emoji="house">üè†</span> <strong>Take-home exercises</strong> (Advanced)</h1>
<p><em>Don‚Äôt worry, the next summative problem set will not require you to write code like asked in here.</em></p>
<section id="q5-re-run-step3-regression" class="level2">
<h2 class="anchored" data-anchor-id="q5-re-run-step3-regression">Q5: Re-run Step3 (Regression)</h2>
<p>Build a standalone SVM model (<code>tidymodels</code> version) on the same data we used in Step 3 of W08 lab, only this time set the parameters of the SVM to the optimal parameters identified in Step 4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q6-predict-the-external-validation-set" class="level2">
<h2 class="anchored" data-anchor-id="q6-predict-the-external-validation-set">Q6: Predict the external validation set</h2>
<p>Use the model you built in Q5 and make predictions on the external validation set. How does the RMSE of these predictions compare to the RMSE of the internal validation set?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q7-svm-decision-space-regression" class="level2">
<h2 class="anchored" data-anchor-id="q7-svm-decision-space-regression">Q7: SVM Decision Space (Regression)</h2>
<p>Replicate the plot from Step 3.3 of W08 lab roadmap, only this time using the model from Q5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q8-compare-svm-decision-space-plots" class="level2">
<h2 class="anchored" data-anchor-id="q8-compare-svm-decision-space-plots">Q8: Compare SVM Decision Space plots</h2>
<p>Explain if and how the decision space you obtained in Q8 differs from the one in Step 3.3.</p>
<blockquote class="blockquote">
<p>your text goes here</p>
</blockquote>
</section>
<section id="q9-grid-search-for-orange-juice-classification" class="level2">
<h2 class="anchored" data-anchor-id="q9-grid-search-for-orange-juice-classification">Q9: Grid search for Orange Juice (Classification)</h2>
<ul>
<li><p>For this task, you will use the Orange Juice data set (<code>ISLR2::OJ</code>) with ALL the predictors included</p></li>
<li><p>Replicate the entire procedure of Step 4, making the necessary adjustments to predict <code>Purchase</code></p></li>
<li><p>Use F1 score as the optimisation metric.</p></li>
</ul>
<p><span class="emoji" data-emoji="bulb">üí°</span>You will have two tweak at least two main things: <code>metric_set</code> and <code>set_mode</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q10-challenge" class="level2">
<h2 class="anchored" data-anchor-id="q10-challenge">Q10: Challenge</h2>
<p>Replicate the same steps as in Q9 for different SVM kernels (linear, polynomial, etc.). Is it possible to fit a model that is better than the radial kernel,in terms of F1-score?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code goes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/(?:lse-dsi\.github\.io\/|localhost)/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../weeks/week08/lab.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">üíª Lab roadmap</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../weeks/week09.html" class="pagination-link">
        <span class="nav-page-text">Week 09</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, LSE Data Science Institute</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:DSI.Admin@lse.ac.uk">
      <i class="bi bi-mailbox" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/lsedatascience">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>